<!DOCTYPE html>
<html>
<head>
    <title>AI Phishing Detection System</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            padding: 40px;
            max-width: 900px;
            margin: auto;
        }

        h2 {
            color: #333;
        }

        textarea {
            width: 100%;
            height: 180px;
            font-size: 14px;
            padding: 10px;
        }

        input[type="file"] {
            margin-top: 10px;
        }

        button {
            padding: 10px 20px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 14px;
        }

        .result {
            margin-top: 25px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
        }

        .high {
            background: #ffdddd;
            border-left: 6px solid #d9534f;
        }

        .medium {
            background: #fff3cd;
            border-left: 6px solid #f0ad4e;
        }

        .low {
            background: #ddffdd;
            border-left: 6px solid #5cb85c;
        }

        .section {
            margin-bottom: 30px;
        }

        .label {
            font-weight: bold;
        }
    </style>
</head>

<body>

<h2>AI-Based Phishing Detection System</h2>

<div class="section">
    <p class="label">Paste the email or message content (before clicking any link):</p>

    <textarea id="emailText" placeholder="Paste email / message text here..."></textarea>
    <br>
    <button onclick="analyzeEmail()">Analyze Text</button>
</div>

<hr>

<div class="section">
    <p class="label">OR Upload Screenshot of Email / Message:</p>

    <input type="file" id="imageFile" accept="image/*">
    <br>
    <button onclick="analyzeImage()">Analyze Image</button>
</div>

<div id="output" class="result"></div>

<script>
function displayResult(data) {
    let risk = data["Final Risk Score"];
    let cls = data["Classification"];

    let color = "low";
    if (risk >= 0.6) color = "high";
    else if (risk >= 0.3) color = "medium";

    let indicators = data["Psychological Indicators"] || [];

    let extractedText = data["Extracted Text"]
        ? "\n\n--- Extracted Text from Image ---\n" + data["Extracted Text"]
        : "";

    document.getElementById("output").className = "result " + color;
    document.getElementById("output").innerText =
        "Classification: " + cls +
        "\nFinal Risk Score: " + risk +
        "\n\nReasons Detected:\n- " + indicators.join("\n- ") +
        extractedText;
}

function analyzeEmail() {
    const email = document.getElementById("emailText").value;

    if (!email.trim()) {
        alert("Please paste email content.");
        return;
    }

    fetch("/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: email })
    })
    .then(res => res.json())
    .then(data => displayResult(data))
    .catch(err => alert("Error analyzing email."));
}

function analyzeImage() {
    const fileInput = document.getElementById("imageFile");
    const file = fileInput.files[0];

    if (!file) {
        alert("Please select an image file.");
        return;
    }

    const formData = new FormData();
    formData.append("image", file);

    fetch("/analyze-image", {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => displayResult(data))
    .catch(err => alert("Error analyzing image."));
}
</script>

</body>
</html>
